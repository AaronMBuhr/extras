rewrite_rules:
- comment: 'Meraki Events'
  match:
  - field: message
    op: =~
    value: \d{10}\.\d{9} (MX\d+) (\S+) (.*)
  kv:
    delimiter: ''
    separator: '='
  tag:
    ut_cisco_meraki_dst_ips: ${dst}
    ut_cisco_meraki_protocols: ${protocol}
    ut_cisco_meraki_src_ips: ${src}
    ut_cisco_meraki_types: ${type}
    ut_cisco_meraki_patterns: ${pattern}
  update:
    program: Meraki_$2
    message: $1 $2 $3
- comment: 'Meraki AD Users, depends on ../../../../syslog-ng/remove-ldap-spaces.conf'
  match:
  - field: program
    op: =*
    value: 'Meraki'
  - field: message
    op: =~
    value: 'user=CN=([^,]+)'
  tag:
    ut_cisco_meraki_users: $1
- comment: 'Extract src and dst ports'
  match:
  - field: program
    op: =*
    value: 'Meraki'
  - field: message
    op: =~
    value: 'src=[^:]+:(\d+) dst=[^:]+:(\d+)'
  tag:
    ut_cisco_meraki_src_port: $1
    ut_cisco_meraki_dst_port: $2
